name: nomos-strong-guarantee-reference

on:
  workflow_dispatch:

jobs:
  nomos-reference:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    env:
      NOMOS_RUNTIME_STRONG_GUARANTEE: "true"
      NOMOS_RUNTIME_DEPLOYMENT_MODE: "ci"
      NOMOS_MCP_ENABLED: "true"
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.24.13"

      - name: Build Nomos
        run: |
          go build -o ./bin/nomos ./cmd/nomos

      - name: Strong-guarantee preflight
        run: |
          echo "Reference workflow only."
          echo "Run 'nomos doctor' with an environment-specific strong-guarantee config before agent execution."
          echo "That config must satisfy the strong-guarantee hardening checks (container sandbox, mTLS, OIDC, durable audit, deployment-bound environment)."
